# 3_3_Windows執行檔 PE+分析.md
```
使用dev-c++編譯 helloCTFer.c ==> helloCTFer.exe
```
```
下載 helloCTFer.exe
```
```
file helloCTFer.exe 

helloCTFer.exe: PE32+ executable (console) x86-64, for MS Windows
```
```
 objdump -x helloCTFer.exe 

helloCTFer.exe:     file format pei-x86-64
helloCTFer.exe
architecture: i386:x86-64, flags 0x0000013a:
EXEC_P, HAS_DEBUG, HAS_SYMS, HAS_LOCALS, D_PAGED
start address 0x0000000000401500

Characteristics 0x27
	relocations stripped
	executable
	line numbers stripped
	large address aware

Time/Date		Fri Mar  5 17:15:53 2021
Magic			020b	(PE32+)
MajorLinkerVersion	2
MinorLinkerVersion	24
SizeOfCode		00001e00
SizeOfInitializedData	00001c00
SizeOfUninitializedData	00000c00
AddressOfEntryPoint	0000000000001500
BaseOfCode		0000000000001000
ImageBase		0000000000400000
SectionAlignment	0000000000001000
FileAlignment		0000000000000200
MajorOSystemVersion	4
MinorOSystemVersion	0
MajorImageVersion	0
MinorImageVersion	0
MajorSubsystemVersion	5
MinorSubsystemVersion	2
Win32Version		00000000
SizeOfImage		00022000
SizeOfHeaders		00000600
CheckSum		00021e74
Subsystem		00000003	(Windows CUI)
DllCharacteristics	00000000
SizeOfStackReserve	0000000000200000
SizeOfStackCommit	0000000000001000
SizeOfHeapReserve	0000000000100000
SizeOfHeapCommit	0000000000001000
LoaderFlags		00000000
NumberOfRvaAndSizes	00000010

The Data Directory
Entry 0 0000000000000000 00000000 Export Directory [.edata (or where ever we found it)]
Entry 1 0000000000008000 000007c8 Import Directory [parts of .idata]
Entry 2 0000000000000000 00000000 Resource Directory [.rsrc]
Entry 3 0000000000005000 00000234 Exception Directory [.pdata]
Entry 4 0000000000000000 00000000 Security Directory
Entry 5 0000000000000000 00000000 Base Relocation Directory [.reloc]
Entry 6 0000000000000000 00000000 Debug Directory
Entry 7 0000000000000000 00000000 Description Directory
Entry 8 0000000000000000 00000000 Special Directory
Entry 9 000000000000a020 00000028 Thread Storage Directory [.tls]
Entry a 0000000000000000 00000000 Load Configuration Directory
Entry b 0000000000000000 00000000 Bound Import Directory
Entry c 00000000000081ec 000001b0 Import Address Table Directory
Entry d 0000000000000000 00000000 Delay Import Directory
Entry e 0000000000000000 00000000 CLR Runtime Header
Entry f 0000000000000000 00000000 Reserved

There is an import table in .idata at 0x408000

The Import Tables (interpreted .idata section contents)
 vma:            Hint    Time      Forward  DLL       First
                 Table   Stamp     Chain    Name      Thunk
 00008000	0000803c 00000000 00000000 00008738 000081ec

	DLL Name: KERNEL32.dll
	vma:  Hint/Ord Member-Name Bound-To
	839c	  216  DeleteCriticalSection
	83b4	  248  EnterCriticalSection
	83cc	  461  GetCurrentProcess
	83e0	  462  GetCurrentProcessId
	83f6	  466  GetCurrentThreadId
	840c	  528  GetLastError
	841c	  627  GetStartupInfoA
	842e	  650  GetSystemTimeAsFileTime
	8448	  677  GetTickCount
	8458	  761  InitializeCriticalSection
	8474	  843  LeaveCriticalSection
	848c	  955  QueryPerformanceCounter
	84a6	 1025  RtlAddFunctionTable
	84bc	 1026  RtlCaptureContext
	84d0	 1033  RtlLookupFunctionEntry
	84ea	 1040  RtlVirtualUnwind
	84fe	 1183  SetUnhandledExceptionFilter
	851c	 1196  Sleep
	8524	 1210  TerminateProcess
	8538	 1217  TlsGetValue
	8546	 1230  UnhandledExceptionFilter
	8562	 1260  VirtualProtect
	8574	 1262  VirtualQuery

 00008014	000080fc 00000000 00000000 000087bc 000082ac

	DLL Name: msvcrt.dll
	vma:  Hint/Ord Member-Name Bound-To
	8584	   55  __C_specific_handler
	859c	   78  __dllonexit
	85aa	   81  __getmainargs
	85ba	   82  __initenv
	85c6	   83  __iob_func
	85d4	   90  __lconv_init
	85e4	   96  __set_app_type
	85f6	   98  __setusermatherr
	860a	  116  _acmdln
	8614	  123  _amsg_exit
	8622	  141  _cexit
	862c	  253  _fmode
	8636	  329  _initterm
	8642	  441  _lock
	864a	  610  _onexit
	8654	  818  _unlock
	865e	 1030  abort
	8666	 1044  calloc
	8670	 1055  exit
	8678	 1072  fprintf
	8682	 1079  free
	868a	 1090  fwrite
	8694	 1137  malloc
	869e	 1145  memcpy
	86a8	 1152  printf
	86b2	 1174  signal
	86bc	 1193  strlen
	86c6	 1196  strncmp
	86d0	 1227  vfprintf

 00008028	00000000 00000000 00000000 00000000 00000000

The Function Table (interpreted .pdata section contents)
vma:			BeginAddress	 EndAddress	  UnwindData
 0000000000405000:	0000000000401000 0000000000401001 0000000000406000
 000000000040500c:	0000000000401010 0000000000401151 0000000000406004
 0000000000405018:	0000000000401160 00000000004011ae 000000000040600c
 0000000000405024:	00000000004011b0 00000000004014ce 0000000000406014
 0000000000405030:	00000000004014d0 00000000004014f2 0000000000406028
 000000000040503c:	0000000000401500 0000000000401522 0000000000406048
 0000000000405048:	0000000000401530 0000000000401554 0000000000406068
 0000000000405054:	0000000000401560 0000000000401564 0000000000406074
 0000000000405060:	0000000000401570 0000000000401574 0000000000406078
 000000000040506c:	0000000000401580 0000000000401583 000000000040607c
 0000000000405078:	0000000000401590 00000000004015d1 0000000000406080
 0000000000405084:	00000000004015e0 00000000004015ec 0000000000406088
 0000000000405090:	00000000004015f0 00000000004016ec 000000000040608c
 000000000040509c:	00000000004016f0 0000000000401751 00000000004060a4
 00000000004050a8:	0000000000401760 00000000004018c2 00000000004060b0
 00000000004050b4:	00000000004018d0 0000000000401bc9 00000000004060c4
 00000000004050c0:	0000000000401bd0 0000000000401d76 00000000004060dc
 00000000004050cc:	0000000000401d80 0000000000401e6c 00000000004060e4
 00000000004050d8:	0000000000401e70 0000000000402028 00000000004060f4
 00000000004050e4:	0000000000402030 0000000000402033 00000000004060fc
 00000000004050f0:	0000000000402040 0000000000402075 0000000000406100
 00000000004050fc:	0000000000402080 00000000004020d5 0000000000406108
 0000000000405108:	00000000004020e0 00000000004020fc 0000000000406114
 0000000000405114:	0000000000402100 00000000004021d6 0000000000406118
 0000000000405120:	00000000004021e0 00000000004022db 0000000000406128
 000000000040512c:	00000000004022e0 000000000040230f 0000000000406138
 0000000000405138:	0000000000402310 0000000000402379 0000000000406140
 0000000000405144:	0000000000402380 0000000000402383 000000000040614c
 0000000000405150:	0000000000402390 0000000000402437 0000000000406150
 000000000040515c:	0000000000402440 0000000000402459 0000000000406158
 0000000000405168:	0000000000402460 000000000040246a 0000000000406160
 0000000000405174:	0000000000402470 000000000040248f 0000000000406164
 0000000000405180:	0000000000402490 00000000004024a2 0000000000406168
 000000000040518c:	00000000004024b0 00000000004024f5 000000000040616c
 0000000000405198:	0000000000402500 000000000040259e 0000000000406170
 00000000004051a4:	00000000004025a0 00000000004025e3 000000000040617c
 00000000004051b0:	00000000004025f0 000000000040262b 0000000000406188
 00000000004051bc:	0000000000402630 00000000004026be 0000000000406190
 00000000004051c8:	00000000004026c0 00000000004026f8 000000000040619c
 00000000004051d4:	0000000000402700 0000000000402755 00000000004061a8
 00000000004051e0:	0000000000402760 000000000040280e 00000000004061b4
 00000000004051ec:	0000000000402810 000000000040287d 00000000004061c4
 00000000004051f8:	0000000000402880 00000000004028ff 00000000004061d4
 0000000000405204:	0000000000402900 000000000040299f 00000000004061e0
 0000000000405210:	00000000004029a0 0000000000402a37 00000000004061e8
 000000000040521c:	0000000000402aa0 0000000000402aa8 00000000004061f0
 0000000000405228:	0000000000402ab0 0000000000402abb 00000000004061f4

Dump of .xdata
 0000000000406000 (rva: 00006000): 0000000000401000 - 0000000000401001
	Version: 1, Flags: none
	Nbr codes: 0, Prologue size: 0x00, Frame offset: 0x0, Frame reg: none
 0000000000406004 (rva: 00006004): 0000000000401010 - 0000000000401151
	Version: 1, Flags: none
	Nbr codes: 1, Prologue size: 0x04, Frame offset: 0x0, Frame reg: none
	  pc+0x04: alloc small area: rsp = rsp - 0x28
 000000000040600c (rva: 0000600c): 0000000000401160 - 00000000004011ae
	Version: 1, Flags: none
	Nbr codes: 1, Prologue size: 0x04, Frame offset: 0x0, Frame reg: none
	  pc+0x04: alloc small area: rsp = rsp - 0x38
 0000000000406014 (rva: 00006014): 00000000004011b0 - 00000000004014ce
	Version: 1, Flags: none
	Nbr codes: 8, Prologue size: 0x0f, Frame offset: 0x0, Frame reg: none
	  pc+0x0f: alloc large area: rsp = rsp - 0x98
	  pc+0x08: push rbx
	  pc+0x07: push rsi
	  pc+0x06: push rdi
	  pc+0x05: push rbp
	  pc+0x04: push r12
	  pc+0x02: push r13
 0000000000406028 (rva: 00006028): 00000000004014d0 - 00000000004014f2


```
# objdump -M intel -d helloCTFer.exe
```
helloCTFer.exe:     file format pei-x86-64

Disassembly of section .text:

0000000000401000 <__mingw_invalidParameterHandler>:
  401000:	c3                   	ret    
  401001:	66 66 66 66 66 66 2e 	data16 data16 data16 data16 data16 nop WORD PTR cs:[rax+rax*1+0x0]
  401008:	0f 1f 84 00 00 00 00 
  40100f:	00 

0000000000401010 <pre_c_init>:
  401010:	48 83 ec 28          	sub    $0x28,%rsp
  401014:	48 8b 05 25 34 00 00 	mov    0x3425(%rip),%rax        # 404440 <.refptr.mingw_initltsdrot_force>
  40101b:	31 d2                	xor    %edx,%edx
  40101d:	c7 00 01 00 00 00    	movl   $0x1,(%rax)
  401023:	48 8b 05 26 34 00 00 	mov    0x3426(%rip),%rax        # 404450 <.refptr.mingw_initltsdyn_force>
  40102a:	c7 00 01 00 00 00    	movl   $0x1,(%rax)

```

```
0000000000401530 <main>:
  401530:	55                   	push   rbp
  401531:	48 89 e5             	mov    rbp,rsp
  401534:	48 83 ec 20          	sub    rsp,0x20
  401538:	e8 a3 0b 00 00       	call   4020e0 <__main>
  40153d:	48 8d 0d bc 2a 00 00 	lea    rcx,[rip+0x2abc]        # 404000 <.rdata>
  401544:	e8 af 15 00 00       	call   402af8 <printf>
  401549:	b8 00 00 00 00       	mov    eax,0x0
  40154e:	48 83 c4 20          	add    rsp,0x20
  401552:	5d                   	pop    rbp
  401553:	c3                   	ret    
  401554:	90                   	nop
  401555:	90                   	nop
  401556:	90                   	nop
  401557:	90                   	nop
  401558:	90                   	nop
  401559:	90                   	nop
  40155a:	90                   	nop
  40155b:	90                   	nop
  40155c:	90                   	nop
  40155d:	90                   	nop
  40155e:	90                   	nop
  40155f:	90                   	nop
```
#  hexdump -C helloCTFer.exe 
```
00000000  4d 5a 90 00 03 00 00 00  04 00 00 00 ff ff 00 00  |MZ..............|
00000010  b8 00 00 00 00 00 00 00  40 00 00 00 00 00 00 00  |........@.......|
00000020  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000030  00 00 00 00 00 00 00 00  00 00 00 00 80 00 00 00  |................|
00000040  0e 1f ba 0e 00 b4 09 cd  21 b8 01 4c cd 21 54 68  |........!..L.!Th|
00000050  69 73 20 70 72 6f 67 72  61 6d 20 63 61 6e 6e 6f  |is program canno|
00000060  74 20 62 65 20 72 75 6e  20 69 6e 20 44 4f 53 20  |t be run in DOS |
00000070  6d 6f 64 65 2e 0d 0d 0a  24 00 00 00 00 00 00 00  |mode....$.......|
00000080  50 45 00 00 64 86 11 00  c9 f6 41 60 00 80 01 00  |PE..d.....A`....|
00000090  b8 05 00 00 f0 00 27 00  0b 02 02 18 00 1e 00 00  |......'.........|
000000a0  00 1c 00 00 00 0c 00 00  00 15 00 00 00 10 00 00  |................|
000000b0  00 00 40 00 00 00 00 00  00 10 00 00 00 02 00 00  |..@.............|
000000c0  04 00 00 00 00 00 00 00  05 00 02 00 00 00 00 00  |................|
000000d0  00 20 02 00 00 06 00 00  74 1e 02 00 03 00 00 00  |. ......t.......|
000000e0  00 00 20 00 00 00 00 00  00 10 00 00 00 00 00 00  |.. .............|
000000f0  00 00 10 00 00 00 00 00  00 10 00 00 00 00 00 00  |................|
00000100  00 00 00 00 10 00 00 00  00 00 00 00 00 00 00 00  |................|
00000110  00 80 00 00 c8 07 00 00  00 00 00 00 00 00 00 00  |................|
00000120  00 50 00 00 34 02 00 00  00 00 00 00 00 00 00 00  |.P..4...........|
00000130  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000150  20 a0 00 00 28 00 00 00  00 00 00 00 00 00 00 00  | ...(...........|
00000160  00 00 00 00 00 00 00 00  ec 81 00 00 b0 01 00 00  |................|
00000170  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
00000180  00 00 00 00 00 00 00 00  2e 74 65 78 74 00 00 00  |.........text...|
00000190  60 1c 00 00 00 10 00 00  00 1e 00 00 00 06 00 00  |`...............|
000001a0  00 00 00 00 00 00 00 00  00 00 00 00 20 00 50 60  |............ .P`|
000001b0  2e 64 61 74 61 00 00 00  90 00 00 00 00 30 00 00  |.data........0..|
000001c0  00 02 00 00 00 24 00 00  00 00 00 00 00 00 00 00  |.....$..........|
000001d0  00 00 00 00 40 00 50 c0  2e 72 64 61 74 61 00 00  |....@.P..rdata..|
000001e0  d0 07 00 00 00 40 00 00  00 08 00 00 00 26 00 00  |.....@.......&..|
000001f0  00 00 00 00 00 00 00 00  00 00 00 00 40 00 50 40  |............@.P@|
00000200  2e 70 64 61 74 61 00 00  34 02 00 00 00 50 00 00  |.pdata..4....P..|
00000210  00 04 00 00 00 2e 00 00  00 00 00 00 00 00 00 00  |................|
00000220  00 00 00 00 40 00 30 40  2e 78 64 61 74 61 00 00  |....@.0@.xdata..|


```
